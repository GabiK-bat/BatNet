<html>
<head>
  <title>ðŸ¦‡ Bat Detector</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
  <script  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
  <script src="/static/util.js"></script>
  <script src="/static/script.js"></script>
  <script src="/static/boxes.js"></script>
  <script src="/static/download.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

  <!--<script src="/static/magnifier.js"></script>
  <link rel="stylesheet" href="/static/styles.css">-->


  <script id="filetable-item-template" type="text/x-jQuery-tmpl">
    <tr class="ui title" filename="${filename}">
      <!--<td> <i class="dropdown icon"></i>${filename}</td>-->
      <td> 
        <i class="dropdown icon"></i>
        <i class="icons" style="font-style: normal;">
          <i class="image icon"></i>
          ${filename}
        </i>
      </td>
      <td id="detected_${filename}"></td>
      <td onclick="on_flag(event);">
        <i class="flag icon" id="flag_${filename}" style="display:block;  margin-left:auto; margin-right:auto;"></i>
      </td>
    </tr>
    <tr style="display:none">
      <td colspan="5" class="ui content" filename="${filename}" style="padding-bottom:21px">
        {{tmpl({filename:filename}) "#filelist-item-content-template"}}
      </td>
    </tr>
  </script>

  <script id="filelist-item-content-template" type="text/x-jQuery-tmpl">
    <div filename="${filename}">
      <div class="ui big images">
          <div class="ui image">
            <div class="image-container">
            <!--<img class="ui image"       src="/images/${filename}"-->
            <img class="ui image"       src=""
                 id="image_${filename}" style="margin:0;">
            </div>
            
            <div class="ui top right attached label icon" style="border-top-right-radius: 0;">
              <i class="zoom-in icon" style="cursor:pointer; display:none;" onclick="on_zoom_button(event)" title="Zoom"></i>
              <i class="play link blue icon" onclick="on_process_image(event)"  title="Process Image"></i>
              <i class="plus link icon" onclick="on_add_custom_box_button(event)"  title="Add Custom Box"></i>
            </div>
          </div>
      </div>


      <div class="ui two column stackable grid" id="patches_${filename}">
          <!-- result-details-template -->
      </div>
    </div>
  </script>


  <script id="result-details-template" type="text/x-jQuery-tmpl">
    <div class="column result-details" index="${index}" filename="${filename}" >
    <div class="ui segment" style="padding-top: 0px;">
      <a class="ui top right attached label" onclick="on_remove_prediction(event)">
          <i class="close icon" style="cursor:pointer"></i>
      </a>
      <div class="ui grid">
            <img class="ui small image six wide column" style="padding-right:0" src="/images/patch_${i}_${filename}?_=${time}">
            <table class="ui compact table ten wide column" style="border:0; padding:0;">
                <!--checkbox-confidence-template-->
              <tfoot class="full-width">
              <tr>
                <th class="collapsing">
                    <div class="ui fitted checkbox" index="-1">
                      <input type="checkbox"> <label></label>
                    </div>
                </th>
                <th colspan="4" class="ui tiny form sixteen wide">
                    <input type="text" name="new-label" placeholder="Other" oninput="on_custom_label_input(event)">
                </th>
              </tr>
              </tfoot>
            </table>
        </div>
    </div></div>
  </script>


  <script id="checkbox-confidence-template" type="text/x-jQuery-tmpl">
  <tr>
    <td class="collapsing">
      <div class="ui fitted checkbox" index="${index}">
        <input type="checkbox"> <label></label>
      </div>
    </td>
    <td class="six wide ">${label}</td>
    <td class="ten wide">
        <div class="ui small progress" style="margin-bottom: 0px;">
          <div class="bar"></div>
        </div>
    </td>
  </tr>
  </script>

  <script id="box-overlay-template" type="text/x-jQuery-tmpl">
    <div style="position:absolute; 
                outline: solid #ffffff 2px;
                top:${box[0]*100}%;        left:${box[1]*100}%; 
                bottom:${100-box[2]*100}%; right:${100-box[3]*100}%;"
         class="box-overlay" index="${index}">
    </div>
  </script>

</head>








<body>

<div class="ui container menu" style="margin-top:5px">

  <div class="ui simple dropdown item">
    <span class="text">Files</span>
    <i class="dropdown icon"></i>
    <div class="ui menu">
      <label for="input_images" class="ui icon item">
        <i class="images icon"></i>
        Select Input Images
      </label>
      <input type="file" id="input_images" style="display:none"
            onchange="on_inputfiles_select(event)" accept="image/*" multiple>
      

      <label for="input_folder" class="ui icon item">
        <i class="folder icon"></i>
        Select Input Folder
      </label>
      <input type="file" id="input_folder" style="display:none"
            onchange="on_inputfolder_select(this)"  webkitdirectory directory multiple>
      <div class="divider"></div>

      <input type="file" id="input_training_images" style="display:none" onclick="this.value=null;"
            onchange="on_training_images_select(event)" accept="image/*" multiple>
      
      <label for="input_training_json" class="ui icon item">
        <i class="outline clone icon"></i>
        Select JSON files
      </label>
      <input type="file" id="input_training_json" style="display:none" onclick="this.value=null;"
            onchange="on_training_json_select(event)" accept=".json" multiple>

    </div>
  </div>

<div class="item">
  <div class="buttons">
  <label class="ui primary button" onclick="process_all()" id="process-all-button">
      <i class="play icon"></i>
      Process All Images
  </label>
  <label class="ui violet button" onclick="on_retrain()" id="retrain-button" style="display:none;">
    <i class="redo alternate icon"></i>
    Retrain
  </label>
  <label class="ui red button" onclick="cancel_processing()" id="cancel-processing-button" style="display:none;">
      <i class="x icon"></i>
      Cancel
  </label>
  </div>
</div>


<div class="ui secondary right menu">
    <div class="item">
      <div class="three ui buttons">
        <label class="ui button" onclick="on_metadata()"
            id="metadata-button" data-tooltip="Metadata" data-position="bottom center">
        <i class="list icon"></i>
        </label>
        <label class="ui icon button right floated column" id="download-button" data-position="bottom left">
          <i class="download icon"></i>
        </label>
        <div class="ui popup transition hidden vertical menu" style="padding:0">
            <a class="item" onclick="on_download_csv()"     id="download-csv-button"     
              style="align-self:auto;margin:0px"> Download CSV</a>
            <a class="item" onclick="on_download_labelme()" id="download-labelme-button" 
              style="align-self:auto;margin:0px">
              Download LabelMe JSON</a>
        </div>
        <script>$('#download-button').popup({hoverable:true});</script>
        <label class="ui button" onclick="on_settings()"
              id="settings-button" data-tooltip="Settings" data-position="bottom center">
          <i class="wrench icon"></i>
        </label>
      </div>
    </div>
  </div>
</div>


<div class="ui container">
<table class="ui basic celled table accordion" id="filetable">
      <thead><tr>
    <th class="six wide">Filename</th>
    <th class="nine wide">Detected Bats</th>
    <th class="one wide"></th>
    </tr></thead>
  <tbody>
    <tr class="ui">
      <td>No Files Selected</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>
<script>$('.ui.table.accordion').accordion({duration:0, onOpening:on_accordion_open});</script>
<style>
.ui.table td.active, .ui.table tr.active { background: #fff!important;  }
</style>








<div class="ui tiny modal" id="settings-dialog">
  <i class="close icon"></i>
  <div class="header"> Settings </div>

  <div class="ui form content">
    <div class="field">
    <label>Model to use</label>
    <div class="ui dropdown selection" id="settings-active-model">
      <input type="hidden" name="active-model">
      <i class="dropdown icon"></i>
      <div class="default text">Select a model</div>
      <div class="menu">
        <div class="item" data-value="0">Basemodel</div>
        <div class="item" data-value="1">Another one</div>
      </div>
    </div>
    </div>

    <div class="field">
      <label>Retraining</label>
      <div class="ui toggle checkbox" id="settings-enable-retraining">
        <input type="checkbox">
        <label>Enable retraining</label>
      </div>
    </div>

    <div class="field" id="settings-new-modelname-field">
      <label>Save retrained model</label>
      <div class="ui action input">
        <input type="text" placeholder="New model name" id="settings-new-modelname">
        <button class="ui violet right labeled icon button" onclick="on_save_model()">
          <i class="save icon"></i>
          Save
        </button>
      </div>
    </div>

  <div class="actions">
    <div class="ui negative button">
      Cancel
    </div>
    <div class="ui positive right labeled icon button" id="settings-ok-button">
      Save
      <i class="checkmark icon"></i>
    </div>
  </div>
</div>




<div class="ui small modal" id="metadata-dialog">
  <i class="close icon"></i>
  <div class="header"> Metadata </div>
    
    <div class="ui form content">
      <div class="fields">
        <div class="six wide field">
          <label>Site Name</label>
          <input type="text" id="input_site_name">
        </div>
        <div class="six wide field">
          <label>Site Location</label>
          <input type="text" id="input_site_location">
        </div>
        <div class="six wide field">
          <label>Site Responsible</label>
          <input type="text" id="input_site_responsible">
        </div>
      </div>
      <div class="fields">
        <div class="six wide field">
          <label>Country</label>
          <input type="text" id="input_country">
        </div>
        <div class="six wide field">
          <label>Latitude</label>
          <input type="text" id="input_latitude">
        </div>
        <div class="six wide field">
          <label>Longitude</label>
          <input type="text" id="input_longitude">
        </div>
      </div>
      <div class="fields">
        <div class="eight wide field">
          <label>Camera ID</label>
          <input type="text" id="input_camera_id">
        </div>
      </div>
      <div class="field">
        <label>Other</label>
        <textarea rows="4" id="input_other"></textarea>
      </div>
    </div>
    
    <div class="actions">
      <div class="ui negative button">
        Cancel
      </div>
      <div class="ui positive right labeled icon button">
        Save
        <i class="checkmark icon"></i>
      </div>
    </div>
</div>



</body>
</html>
